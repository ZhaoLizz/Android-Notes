# 服务

## 一、服务基本用法

1. 快捷方式创建服务，重写onCreate,onStartCommmand（启动服务时调用）,onDestory方法 手动创建需要在Manifest中声明
2. 在活动中通过intent启动或终止服务 startService(),stopService() ```java //MyService服务 public class MyService extends Service { public MyService() { }

  @Override public IBinder onBind(Intent intent) {

  ```
   // TODO: Return the communication channel to the service.
   throw new UnsupportedOperationException("Not yet implemented");
  ```

  }

  @Override

  //创建服务时调用 public void onCreate() {

  ```
   super.onCreate();
   Log.d("MyService","oncreate");
  ```

  }

  @Override //服务启动时调用 public int onStartCommand(Intent intent, int flags, int startId) {

  ```
   Log.d("MyService","onstartCommand");
   return super.onStartCommand(intent, flags, startId);
  ```

  }

  @Override public void onDestroy() {

  ```
   super.onDestroy();
   Log.d("MyService","ondestory");
  ```

  } }

````
```java
//MainActivity
@Override
    public void onClick(View v) {
        switch (v.getId()){
            case R.id.start_service:
                Intent startIntent = new Intent(this,MyService.class);
                startService(startIntent);
                break;
            case R.id.stop_setvice:
                Intent stopIntent = new Intent(this,MyService.class);
                stopService(stopIntent);
                break;
            default:
                break;
        }
    }
````

## 二、活动与服务通信

1. 在服务内创建实现了想要的功能的类，获取实例
2. 实现服务内的onBind方法，返回服务内功能类的实例，作为对活动类开放的接口
3. 在活动中创建onServiceConnected类，重写onServiceConnected与onServiceDisconnected方法，这两个方法分别在活动与服务绑定与解绑成功时调用。在绑定成功方法中通过向下转型获取服务内功能类的实例并执行功能方法
4. 在活动中通过 `bindService(bindIntent, connection,BIND_AUTO_CREATE);` `unbindService(connection);` 实现活动与服务的绑定与解绑

```java
//MyService
public class MyService extends Service {

    private DownloadBinder mBinder = new DownloadBinder();

    class DownloadBinder extends Binder{

        public void startDownload(){
            Log.d("MyService","startDownload");
        }

        public int getProgress(){
            Log.d("MyService","getProgress");
            return 0;
        }

    }

    public MyService() {
    }

    @Override
    //面向活动的开放接口，提供服务内的功能类的实例
    public IBinder onBind(Intent intent) {
        // TODO: Return the communication channel to the service.
        return mBinder;
        }

    @Override

    //创建服务时调用
    public void onCreate() {
        super.onCreate();
        Log.d("MyService","oncreate");
    }

    @Override
    //服务启动时调用
    public int onStartCommand(Intent intent, int flags, int startId) {
        Log.d("MyService","onstartCommand");
        return super.onStartCommand(intent, flags, startId);
    }

    @Override
    public void onDestroy() {
        super.onDestroy();
        Log.d("MyService","ondestory");
    }
}
```

```java
//MainActivity
    private MyService.DownloadBinder downloadBinder;

    private ServiceConnection connection = new ServiceConnection() {
        @Override
        //活动与服务成功绑定时调用
        public void onServiceConnected(ComponentName name, IBinder service) {
            //向下转型获取实例
            downloadBinder = (MyService.DownloadBinder)service;
            //执行服务内功能类的功能方法
            downloadBinder.startDownload();
            downloadBinder.getProgress();
        }

        @Override
        public void onServiceDisconnected(ComponentName name) {
        }
    };
```

```java
//onClick
            case R.id.bind_service:
                //绑定活动与服务，第三个参数表示自动创建服务
                Intent bindIntent = new Intent(this, MyService.class);
                //调用bindService后回调服务中的onBind方法
                bindService(bindIntent, connection,BIND_AUTO_CREATE);
                break;
            case R.id.unbind_service:
                unbindService(connection);
                break;
```

## 三、使用前台服务
